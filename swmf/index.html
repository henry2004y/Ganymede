<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/Ganymede/libs/highlight/github.min.css"> <link rel=stylesheet  href="/Ganymede/css/franklin.css"> <link rel=stylesheet  href="/Ganymede/css/poole_hyde.css"> <style> html {font-size: 17px;} .franklin-content {position: relative; padding-left: 8%; padding-right: 5%; line-height: 1.35em;} @media (min-width: 940px) { .franklin-content {width: 100%; margin-left: auto; margin-right: auto;} } @media (max-width: 768px) { .franklin-content {padding-left: 6%; padding-right: 6%;} } </style> <link rel=icon  href="/Ganymede/assets/favicon.png"> <title>Run in Action</title> <div class=sidebar > <div class="container sidebar-sticky"> <div class=sidebar-about > <h1><a href="/Ganymede/">CSEM</a></h1> <p class=lead >Our attempts to understand nature.</p> </div> <nav class=sidebar-nav > <a class="sidebar-nav-item " href="/Ganymede/">Home</a> <a class="sidebar-nav-item " href="/Ganymede/log_ganymede/">Log</a> <a class="sidebar-nav-item " href="/Ganymede/simulations_ganymede/">OverView</a> <a class="sidebar-nav-item " href="/Ganymede/extra/">Extra</a> <a class="sidebar-nav-item " href="/Ganymede/galileo/">Observation</a> <a class="sidebar-nav-item " href="/Ganymede/compilation/">Compilation</a> <a class="sidebar-nav-item active" href="/Ganymede/swmf/">Run in Action</a> <a class="sidebar-nav-item " href="/Ganymede/ulfwaves/">ULF Waves</a> <a class="sidebar-nav-item " href="/Ganymede/shocks/">Shocks</a> <a class="sidebar-nav-item " href="/Ganymede/reconnection/">Reconnection</a> <a class="sidebar-nav-item " href="/Ganymede/kaw/">Kinetic Alfvén Waves</a> </nav> <p>&copy; Hongyang Zhou.</p> </div> </div> <div class="content container"> <div class=franklin-content ><h1 id=how_to_run_the_swmf_model ><a href="#how_to_run_the_swmf_model" class=header-anchor >How to run the SWMF model</a></h1> <p>Even though I have been working with SWMF for five years, I will forget how to use it after leaving it for a while or the latest development introduce some breaking changes to the setups. This manual serves as a reference for myself and also other interesting researchers on how to reproduce the simulation.</p> <p>The installation is thoroughly described in the official document. The following assumes you have a basic understanding of running a model in SWMF.</p> <p>In principle, the GM module can run alone without compiling the PC module until the coupling is required. However in practice I recommend run with the coupled executable from start to prevent further work in changing the parameter file at a later stage.</p> <p>After SWMF is successfully installed,</p> <pre><code class=language-julia >./Config.pl -v&#61;Empty,PC/FLEKS,GM/BATSRUS -amrex
./Config.pl -o&#61;GM:g&#61;8,8,8,ng&#61;2,u&#61;Ganymede,e&#61;MhdHypPe</code></pre> <p>If the syntaxes change in the future, you can check how it is configured in <code>Makefile.test</code>.</p> <p>The run can be split into multiple stages:</p> <ul> <li><p>steady state ideal MHD</p> <li><p>quasi-steady state Hall MHD</p> <li><p>time-accurate &#40;time-dependent&#41; Hall MHD</p> <li><p>time-accurate &#40;time-dependent&#41; MHD-EPIC</p> </ul> <p>It is not necessary to strictly follow this order: we do this only to speed things up assuming that the same solution will be reached given the same initial and boundary condition, no matter which timestepping mode or which numerical model is chosen in the intermediate stages. The validity of this statement is hard to prove mathematically, but based on practical experience it generally works pretty well. An analogy to this would be the steady state in a Markov chain: you are guaranteed to stay in the steady state once you reach it, but it is not guaranteed that you will reach the steady state from an arbirary state, even though for many cases it does.</p> <h2 id=steady_state_ideal_mhd ><a href="#steady_state_ideal_mhd" class=header-anchor >Steady State Ideal MHD</a></h2> <pre><code class=language-julia >Name     Root Last Stride
#LAYOUT
GM       0    99999   1
PC       0    99999   1

#PLANET
Ganymede                NamePlanet
2634000                 RadiusPlanet &#91;m&#93;
1.4819E&#43;23              MassPlanet   &#91;kg&#93;
0.0                     OmegaPlanet  &#91;radian/s&#93;
0.0                     TiltRotation &#91;degree&#93;
DIPOLE                  TypeBField
4.                      MagAxisThetaGeo &#91;degree&#93;
291.05                  MagAxisPhiGeo   &#91;degree&#93;
-718.55E-9              DipoleStrength  &#91;T&#93;

#ROTATION
F                       UseRotation

#TIMEACCURATE
F                       DoTimeAccurate

#SAVERESTART
T                       DoSaveRestart
2000                    DnSaveRestart
-1.0                    DtSaveRestart


&#33; Restart header for SWMF
INCLUDE
RESTART.in              NameRestartFile

#CPUTIMEMAX
20000.0                 CpuTimeMax

#CHECKSTOP
T                       DoCheckStop
1000                    DnCheckStop
-1.0                    DtCheckStop

#PROGRESS
200                     DnShowProgressShort
2000                    DnShowProgressLong

#COMPONENT
PC                      NameComp
F                       UseComp

#BEGIN_COMP GM --------------------------------------------------------------

&#33; Restart header for GM
INCLUDE
GM/restartIN/restart.H

#HYPERBOLICDIVB
T                       UseHyperbolicDivb
150.0                   SpeedHypDim
0.1                     HypDecay

#COORDSYSTEM
GSE                     TypeCoordinate

#BODY
T                       UseBody
0.5                     rBody      &#91;rPlanet&#93;
3.5                     rCurrents  &#91;rPlanet&#93;
39                      BodyNDim   &#91;/cc&#93;
2.32e5                  BodyTDim   &#91;K&#93;

#BODY
F

#PLASMA
14.0                    FluidMass &#91;amu&#93;
1.0                     AverageIonCharge &#91;e&#93;
1.0/18.0                ElectronTemperatureRatio

#SEMIKRYLOV
GMRES                   TypeKrylov  &#40;GMRES, BICGSTAB, CG&#41;
0.001                   ErrorMaxKrylov
100                     MaxMatvecKrylov

#MINIMUMPRESSURE
0.001                   pMinDim
0.001                   PeMinDim for electron pressure

#MINIMUMDENSITY
0.1                     RhoMinDim

#NONCONSERVATIVE
F                       UseNonConservative

#CONSERVATIVECRITERIA
0                       nConservCrit

#RESTARTOUTFILE
one                     TypeRestartOutFile

grid structure---------------------------------------------------------------
#GRIDGEOMETRY
spherical_lnr           TypeGeometry

#GRIDBLOCKALL
56000

#GRID
10                       nRootBlockX
8                        nRootBlockY
8                        nRootBlockZ
-100                     xMin
 100                     xMax
-100                     yMin
 100                     yMax
-100                     zMin
 100                     zMax

#LIMITRADIUS
0.5                     rMin
174.0                   rMax &gt; &#40;sqrt&#40;100^2&#43;100^2&#43;100^2&#41;&#41;

#GRIDLEVEL
3                       nLevelArea
initial                 NameArea

#GRIDLEVEL
3                       nLevelArea
box_gen                 TypeRegion
1.1                     rmin            xMinBox
0.0                     LonMin          yMinBox
-65.0                   LatMin          zMinBox
3.0                     rmax            xMaxBox
360.0                   LonMax          yMaxBox
65.0                    LatMax          zMaxBox

#GRIDLEVEL
1                       nLevelArea
box_gen                 TypeRegion
5.0                     rmin
-70.0                   LonMin
35.0                    LatMin
15.0                    rmax
70.0                    LonMax
65.0                    Latmax

#GRIDLEVEL
1                       nLevelArea
box_gen                 TypeRegion
5.0                     rmin
-70.0                   LonMin
-35.0                   LatMin
15.0                    rmax
70.0                    LonMax
-65.0                   LatMax

end grid structure-----------------------------------------------------------

BC---------------------------------------------------------------------------
#OUTERBOUNDARY
fixedb1                 TypeCellBc1
none                    TypeCellBc2
periodic                TypeCellBc3
periodic                TypeCellBc4
periodic                TypeCellBc5
periodic                TypeCellBc6

#BOXBOUNDARY
fixed                   TypeBcXmin
fixed                   TypeBcXmax
float                   TypeBcYmin
float                   TypeBcYmax
float                   TypeBcZmin
float                   TypeBcZmax

#BOUNDARYSTATE
coord1max xminbox xmaxbox         StringBoundary
56.0                    BoundaryStateDim_V Rho
140.0                   BoundaryStateDim_V Ux
0.0                     BoundaryStateDim_V Uy
0.0                     BoundaryStateDim_V Uz
-10.0                   BoundaryStateDim_V Bx
-6.0                    BoundaryStateDim_V By
-86.0                   BoundaryStateDim_V Bz
0.0                     BoundaryStateDim_V Hyp
0.2                     BoundaryStateDim_V Pe
3.6                     BoundaryStateDim_V p

#SOLIDSTATE
T                       UseSolidState
user                    TypeBcSolid
sphere                  TypeSolidGeometry
1.0                     rSolid
5e-3                    SolidLimitDt

end BC-----------------------------------------------------------------------

#RESISTIVITY
T                       UseResistivity
user                    TypeResistivity
0.0                     Eta0Si

#USERSWITCH
&#43;init &#43;ic &#43;source       StringSwitch

#USERINPUTBEGIN -------------------------------------------------------------

#INITTYPE
B1U1

#RESISTIVEPLANET
5                       nResistivePoints
1.05                    Radius
0.0                     Resistivity
0.95                    Radius
6e11                    Resistivity
0.7                     Radius
6e11                    Resistivity
0.65                    Radius
6e9                     Resistivity
0.55                    Radius
0.0                     Resistivity

#MASSLOADING
8.0e6                   NeutralDensity &#40;cm^-3&#41;
250                     ScaleHeight &#40;km&#41;
2.2e-8                  IonizationRate &#40;1/s&#41;
2e-15                   CollisionCrossSection &#40;cm2&#41;

#SOLIDBOUNDARY
3

#USERINPUTEND --------------------------------------------------------------

#TIMESTEPPING
2                       nStage
0.8                     CflExlp

#SCHEME
2                       nOrder &#40;1 or 2&#41;
Sokolov                 TypeFlux &#40;Roe, Rusanov, Linde, Sokolov&#41;
mc3                     TypeLimiter
1.2                     LimiterBeta

#SEMIIMPLICIT
T                       UseSemiImplicit
resistivity             TypeSemiImplicit

#COARSEAXIS
T
1

#SAVEINITIAL
F

#SAVELOGFILE
T                       DoSaveLogfile
RAW                     StringLogfile
1                       DnSaveLogfile
-1.                     DtSaveLogfile

#SAVETECBINARY
T                       DoSaveTecBinary

#SAVEPLOT
3                       nPlotFiles
y&#61;0 VAR idl             StringPlot
5000                    DnSavePlot
-1.                     DtSavePlot
-1.                     Dx
&#123;MHD&#125; b1x b1y b1z divb eta              NameVars
&#123;default&#125;               NamePars
box VAR idl             StringPlot
10000                   DnSavePlot
-1.                     DtSavePlot
GSE                     TypeCoord
-1.29                   x0
0.74                    y0
0.7225                  z0
0.57                    xLen
1/32                    dX
8.832                   yLen
1/32                    dY
0.147                   zLen
1/32                    dZ
0.                      xAngle
0.                      yAngle
0.                      zAngle
bx by bz                NameVars
&#123;default&#125;               NamePars
3d MHD tcp              StringPlot
50000                   DnSavePlot
-1.0                    DtSavePlot

#END_COMP GM --------------------------------------------------------------

#STOP
30000                   MaxIteration
-1.0</code></pre> <p>There are several things worth noticing here:</p> <ul> <li><p>Since <code>DoTimeAccurate &#61; F</code>, all the corresponding time check parameters must switch to <code>Dn</code> but not <code>Dt</code>, i.e. parameters with <code>Dt</code> prefix must be negative and parameters with <code>Dn</code> prefix must be positive integers. This affects the restart control commands <code>SAVERESTART</code>,<code>CHECKSTOP</code> as well as output command <code>SAVEPLOT</code>.</p> <li><p><code>CPUTIMEMAX</code> and <code>CHECKSTOP</code> together controls the running time, and may cause the simulation to stop gracefully before the time you request in a job.</p> <li><p>The <code>BODY</code> command is first turned on and then off to set the <code>rBody</code>. It will be recorded as a parameter in the output file that may be useful for plotting, but it won&#39;t affect anything in the simulation.</p> <li><p>The <code>PLASMA</code> command sets the average mass for the single fluid model, and the initial electron-ion temerature ratio that may change later as a function of time.</p> <li><p>The <code>SEMIKRYLOV</code> command sets the parameters for the semi-implicit solver. There is a similar command <code>KRYLOV</code> with identical input arguments for setting parameters for the full implicit solver.</p> <li><p><code>MINIMUMPRESSURE</code> and <code>MINIMUMDENSITY</code> are used to avoid small discrete timesteps, which is a common trick in MHD and hybrid models. Physically, if the plasma density goes really low, the fluid description may fail to accurately represent the charged particles, which is my explanation of justifying these seemingly arbitrary thresholds. Having one uniform model to describe phenonemon across a wide range of scales is an impossible mission.</p> <li><p>Conservative vs. non-Conservative scheme: the former may be better at resolving shocks and discontinuities, as it follows the same path as the classical RH relation. This is not a critical factor.</p> <li><p>The <code>GRIDBLOCKALL</code> is a useful command for specifying the total number of blocks in the simulation for preallocating memory on each MPI process. There is a default value but it may just waste memory for your grid setup. Unfortunately it is not practical to know the total number of blocks before you run the model. What I usually do is first run the model once to get the total number of block counts, and then set this number slightly larger than that accordingly.</p> <li><p>The <code>GRIDLEVEL</code> command is used for setting AMR. One important control factor lies in the <code>initial</code> NameArea: the number listed here is the maximum level of AMR you can get, no matter what you specify later in each TypeRegion.</p> <li><p>It takes time for one to get used to the boundary settings. The official document of BATSRUS or <code>PARAM.XML</code> provides a detailed description of how these commands work together.</p> <li><p>The <code>SOLIDSTATE</code> command is a trick to solve only the magnetic diffusion-like equation in the mantle region. It looks pretty ugly in the code, so it is likely that this fragile part will potentially break in the future. Here in the steady state run, the useful parameter is <code>SolidLimitDt</code>, which provides a fixed timestep for the mantle cells for updating the magnetic field. The value listed here is only from experience, which tries to be close to the timestep in the MHD domain cell with 2 levels of refinement as prescribed with the above AMR settings right next to the surface. In the time dependent run, this parameter doesn&#39;t have an effect.</p> <li><p>In the <code>RESISTIVITY</code> command, we specify the <code>user</code> type resistivity, which is implemented in <code>user_set_resistivity</code>.</p> <li><p>There are several customized input arguments specified in <code>ModUserGanymede</code>.</p> <ul> <li><p><code>INITTYPE</code> gives the initial settings for B and U;</p> <li><p><code>RESISTIVEPLANET</code> sets a fixed resistivity profile as a function of planet radius;</p> <li><p><code>MASSLOADING</code> sets the parameters related to the ionospheric inner boundary I was testing before AGU2020. Details can be found in other pages;</p> <li><p><code>SOLIDBOUNDARY</code> sets the B, U, P values at the moon&#39;s surface. Definitely I cannot tell what 3 means even I wrote it myself...</p> </ul> <li><p><code>COARSEAXIS</code> may help to overcome the tiny timestep issue at the polar cells. 1 means merge 2 cells into 1 in terms of updating.</p> <li><p><code>SAVEINITIAL</code> determines whether or not to output at the beginning of the run. I set to false often because during restarts we don&#39;t need to save the same snapshot once again.</p> <li><p>In the <code>SAVEPLOT</code> command, several things may go wrong:</p> <ul> <li><p>The first number, <code>nPlotFiles</code>, specifies how many output files there will be. It happens many time that I write a number smaller than the actual number of outputs I list afterwards so that some files are missing.</p> <li><p>The box output is what I used to plot the G8 magnetic field comparisons. Saving it within a box has the advantage of shifting it slightly to get potentially better comparison. However, I think this is no longer necessary, so the <code>SATELLITEFILE</code> command may be a better substitution.</p> </ul> </ul> <h2 id=steady_state_hall_mhd ><a href="#steady_state_hall_mhd" class=header-anchor >Steady State Hall MHD</a></h2> <p>It is allowed to have multiple sessions in one PARAM.in file, separated with the <code>#RUN</code> command. After the local timestepping ideal MHD is finished, what I would do is to create another input file with the following added to the end to the previous PARAM.in:</p> <pre><code class=language-julia >#STOP
1                       MaxIteration
-1.0                    tSimulationMax

#RUN

#BEGIN_COMP GM ------------------------------------------------------------

#HALLRESISTIVITY
T                       UseHallResist &#40;rest of parameters read only if true&#41;
1.0                     HallFactorMax
0.1                     HallCmaxFactor

#HALLREGION
&#43;hallbox -hallsphere -polars
0

#REGION
hallbox                 NameRegion
box tapered             NameHallRegion
-4                      xMinBox
-4                      yMinBox
-4                      zMinBox
4                       xMaxBox
4                       yMaxBox
4                       zMaxBox
0.5                     Taper

#REGION
hallsphere              NameRegion
sphere0 tapered         StringShape
1.05                    Radius
0.05                    Taper

#REGION
polars                  NameRegion
doubleconez0 tapered    StringShape
12                      Height
2.0                     Radius
0.2                     Taper

#END_COMP GM --------------------------------------------------------------

#STOP
30000                   MaxIteration
-1.0                    tSimulationMax</code></pre> <p>Also, remember to turn on the two <code>INCLUDE</code> commands, one for obtaining the restart files for SWMF, the other for GM.</p> <ul> <li><p>A <code>STOP</code> command is required at the end of the ideal MHD session due to an unknown bug related to restart in Hall MHD local timestepping mode. Hopefully someone will solve this in the future.</p> <li><p>Usually 30000 steps is more than enough for the transition.</p> </ul> <p>To link the restart files,</p> <pre><code class=language-shell >./Restart.pl</code></pre>
<p>if you haven&#39;t postprocessed the previous run into another folder. If you have already done <code>./PostProc.pl RESULT/run_ideal</code>, then instead</p>
<pre><code class=language-shell >./Restart.pl -i RESULT/run_ideal</code></pre>
<h2 id=time-accurate_hall_mhd ><a href="#time-accurate_hall_mhd" class=header-anchor >Time-accurate Hall MHD</a></h2>
<p>Just change all the forementioned <code>Dn</code>, <code>Dt</code> parameters together with <code>TIMEACCURATE</code>.</p>
<h2 id=time-accurate_mhd-epic ><a href="#time-accurate_mhd-epic" class=header-anchor >time-accurate MHD-EPIC</a></h2>
<p>There are a bunch of new commands for coupling with PIC. Check the latest version and the manual&#33;</p>
<p>Here is the PARAM.in file that I use for running MHD-EPIC with iPIC3D for G28 in the paper:</p>
<pre><code class=language-julia >#ECHO
T			DoEcho

#DESCRIPTION
Time accurate run for Ganymede G28 flyby with MhdHypPe.
Jovian plasma condition based on observations
face-based innerBC

#PLANET
Ganymede		NamePlanet
2634000			RadiusPlanet &#91;m&#93;
1.4819E&#43;23		MassPlanet   &#91;kg&#93;
0.0			OmegaPlanet  &#91;radian/s&#93;
0.0			TiltRotation &#91;degree&#93;
DIPOLE			TypeBField
2.0284                  MagAxisThetaGeo &#91;degree&#93;
319.3449                MagAxisPhiGeo   &#91;degree&#93;
-717.2494E-9            DipoleStrength  &#91;T&#93;

Alternative description
DIPOLE
175.63                  MagAxisThetaGeo &#91;degree&#93;
109.162                 MagAxisPhiGeo   &#91;degree&#93;
718.895E-9              DipoleStrength  &#91;T&#93;

TEST
CON_axes::init_axes

&#33; The &quot;absorb&quot; BC is not compatible with a co-rotating BC
#ROTATION
F			UseRotation

#TIMEACCURATE
T			DoTimeAccurate

#SAVERESTART
T			DoSaveRestart
-50000			DnSaveRestart
10.			DtSaveRestart


&#33; Restart header for SWMF
#INCLUDE
RESTART.in		NameRestartFile

#CPUTIMEMAX
38000.0			CpuTimeMax

#CHECKSTOP
T                       DoCheckStop
-5000                   DnCheckStop
2.                    	DtCheckStop

#PROGRESS
200			DnShowProgressShort
2000			DnShowProgressLong

#COUPLE2
GM                      NameCompMaster
PC                      NameCompSlave
-1                      DnCouple
0.02                    DtCouple

#COUPLETIME
GM                      NameComp
F                       DoCoupleOnTime

#COUPLETIME
PC                      NameComp
F                       DoCoupleOnTime</code></pre>
<pre><code class=language-julia >#BEGIN_COMP GM ---------------------------------------------------------------

&#33; Restart header for GM
#INCLUDE
GM/restartIN/restart.H

#HYPERBOLICDIVB
T                       UseHyperbolicDivb
150.0                  	SpeedHypDim
0.1                     HypDecay

#COORDSYSTEM
GSE			TypeCoordinate

#BODY
T			UseBody
0.5			rBody      &#91;rPlanet&#93;
3.5			rCurrents  &#91;rPlanet&#93;
39			BodyNDim   &#91;/cc&#93;
2.32e5			BodyTDim   &#91;K&#93;

#BODY
F

#PLASMA
14.0			FluidMass &#91;amu&#93;
1.0                     AverageIonCharge &#91;e&#93;
1.0/18.0                ElectronTemperatureRatio

TEST
krylov

#MINIMUMPRESSURE
0.001			pMinDim
0.001                   PeMinDim for electron pressure

#MINIMUMDENSITY
0.1			RhoMinDim

#NONCONSERVATIVE
F			UseNonConservative

#CONSERVATIVECRITERIA
0			nConservCrit

#RESTARTOUTFILE
one                     TypeRestartOutFile

---------------grid structure-----------------
#GRIDGEOMETRY
spherical_lnr           TypeGeometry

#GRID
10                        proc_dims&#40;1&#41;           nRootBlockX
8                        proc_dims&#40;2&#41;           nRootBlockY
8                        proc_dims&#40;3&#41;,          nRootBlockZ
-100                     x1            xMin
 100                     x2            xMax
-100                     y1            yMin
 100                     y2            yMax
-100                     z1            zMin
 100                     z2            zMax

#LIMITRADIUS
0.5			rMin
174.0                   rMax &gt; &#40;sqrt&#40;100^2&#43;100^2&#43;100^2&#41;&#41;

#GRIDLEVEL
2			nLevelArea
initial			NameArea

#GRIDLEVEL
2			nLevelArea
box_gen         	TypeRegion
1.1             	rmin            xMinBox
0.0            		LonMin          yMinBox
-65.0           	LatMin          zMinBox
4.0 	        	rmax            xMaxBox
360.0           	LonMax          yMaxBox
65.0            	LatMax          zMaxBox

#GRIDLEVEL
1			nLevelArea
box_gen			TypeRegion
5.0			rmin
-70.0			LonMin
35.0			LatMin
15.0			rmax
70.0			LonMax
65.0			Latmax

#GRIDLEVEL
1			nLevelArea
box_gen			TypeRegion
5.0			rmin
-70.0			LonMin
-35.0			LatMin
15.0			rmax
70.0			LonMax
-65.0			LatMax
----------------end grid structure--------------

----------------PIC-----------------
#PICUNIT
1.0                     xUnitPicSi &#91;m&#93;
4000.0e3                uUnitPicSi &#91;m/s&#93;

#PICREGION
1                       nPicRegion
-2.5                    xMinCut
-1.125                  xMaxCut
-2.                     yMinCut
 2.                     yMaxCut
-2.2                    zMinCut
 2.2                    zMaxCut
1/32                    DxPic
1/32                    DyPic
1/32                    DzPic
---------------end PIC--------------


----------------BC-----------------
#OUTERBOUNDARY
fixedb1			TypeCellBc1
none			TypeCellBc2
periodic		TypeCellBc3
periodic		TypeCellBc4
periodic		TypeCellBc5
periodic		TypeCellBc6

#BOXBOUNDARY
fixed			TypeBcXmin
fixed			TypeBcXmax
float			TypeBcYmin
float			TypeBcYmax
float			TypeBcZmin
float			TypeBcZmax

#BOUNDARYSTATE
coord1max xminbox xmaxbox         StringBoundary
28.0                    BoundaryStateDim_V Rho
140.0                   BoundaryStateDim_V Ux
0.0                     BoundaryStateDim_V Uy
0.0                     BoundaryStateDim_V Uz
-7.0                   	BoundaryStateDim_V Bx
78.0                    BoundaryStateDim_V By
-76.0                   BoundaryStateDim_V Bz
0.0                     BoundaryStateDim_V Hyp
0.1                   	BoundaryStateDim_V Pe
1.7                   	BoundaryStateDim_V p

#BOUNDARYSTATE
coord1min solid		StringBoundary
550.0	  		BoundaryStateDim_V Rho
0.0                     BoundaryStateDim_V Ux
0.0                     BoundaryStateDim_V Uy
0.0                     BoundaryStateDim_V Uz
0.0                     BoundaryStateDim_V Bx
0.0                     BoundaryStateDim_V By
0.0                     BoundaryStateDim_V Bz
0.0                     BoundaryStateDim_V Hyp
0.01			BoundaryStateDim_V Pe
0.115			BoundaryStateDim_V p

#SOLIDSTATE
T                       UseSolidState
user                    TypeBcSolid
sphere                  TypeSolidGeometry
1.0                     rSolid
5e-3			SolidLimitDt
-------------end BC--------------

#RESISTIVITY
T			UseResistivity
user			TypeResistivity
0.0			Eta0Si

#USERFLAGS
T                       UseUserInnerBcs
F                       UseUserSource
F                       UseUserPerturbation
F                       UseUserOuterBcs
T                       UseUserICs
F                       UseUserSpecifyRefinement
F                       UseUserLogFiles
F                       UseUserWritePlot
F                       UseUserAMR
F                       UseUserEchoInput
F                       UseUserB0
T                       UseUserInitSession
F                       UseUserUpdateStates

#USERINPUTBEGIN --------------------

#INITTYPE
B1U1

#RESISTIVEPLANET
1.0                     PlanetRadius
5                       nResistivPoints
1.05                    Radius
0.0                     Resistivity
0.95                    Radius
6e11			Resistivity
0.7                     Radius
6e11			Resistivity
0.65                    Radius
6e9			Resistivity
0.55		        Radius
0.0		        Resistivity
#USERINPUTEND ----------------------

#TIMESTEPPING
2			nStage
0.8			CflExlp

#SCHEME
2                       nOrder &#40;1 or 2&#41;
Sokolov                 TypeFlux &#40;Roe, Rusanov, Linde, Sokolov
mc3                     TypeLimiter
1.2                     LimiterBeta

#SEMIIMPLICIT
T			UseSemiImplicit
resistivity		TypeSemiImplicit

#SEMIKRYLOV
GMRES			TypeKrylov &#40;GMRES, BICGSTAB, CG&#41;
0.001 			ErrorMaxKrylov
100 			MaxMatvecKrylov

#UPDATECHECK
F                       UseUpdateCheck

#COARSEAXIS
F			UsePoleDiffusion
T			UseCoarseAxis
1			nCoarseLayer

#RAYTRACE
T                       UseRaytrace &#40;rest is read if true&#41;
T                       UseAccurateTrace
0.1                     DtExchangeRay &#91;sec&#93;
1                       DnRaytrace

#HALLRESISTIVITY
T                       UseHallResist &#40;rest of parameters read only if true&#41;
1.0                     HallFactorMax
0.1                     HallCmaxFactor

#HALLREGION
&#43;hallbox -hallsphere -polars
0

#REGION
hallbox                 NameRegion
box tapered             NameHallRegion
-4                      xMinBox
-4                      yMinBox
-4                      zMinBox
4                       xMaxBox
4                       yMaxBox
4                       zMaxBox
0.5                     Taper

#REGION
hallsphere              NameRegion
sphere0 tapered         StringShape
1.05                    Radius
0.05                    Taper

#REGION
polars                  NameRegion
doubleconez0 tapered    StringShape
12                      Height
2.0                     Radius
0.2                     Taper


#SAVEINITIAL
T

#SAVELOGFILE
T			DoSaveLogfile
RAW			StringLogfile
1			DnSaveLogfile
-1.			DtSaveLogfile

#SAVEPLOT
7                       nPlotFiles
x&#61;0 VAR idl             StringPlot
-1000                   DnSavePlot
1.                     	DtSavePlot
-1.                     Dx
&#123;MHD&#125; status           	NameVars
&#123;default&#125;               NamePars
y&#61;0 VAR idl             StringPlot
-1000                   DnSavePlot
1.                     	DtSavePlot
-1.                     Dx
&#123;MHD&#125; status pic           NameVars
&#123;default&#125;               NamePars
z&#61;0 VAR idl             StringPlot
-1000                   DnSavePlot
1.                     	DtSavePlot
-1.                     Dx
&#123;MHD&#125; status pic          	NameVars
&#123;default&#125;               NamePars
box VAR idl             StringPlot
-5000                   DnSavePlot
1.                     	DtSavePlot
GSE                     TypeCoord
-1.0950                 x0
-0.0330                 y0
-0.3800                 z0
1.2660                  xLen
1/32                    dX
15.3340                 yLen
1/32                    dY
0.1500                  zLen
1/32                    dZ
0.                      xAngle
0.                      yAngle
0.                      zAngle
bx by bz                NameVars
&#123;default&#125;               NamePars
box VAR idl             StringPlot
-1                      DnSavePlot
1.                      DtSavePlot
GSE                     TypeCoord
-1.1                    x0
0.0                     y0
0.0                     z0
2.2                     xLen
1/30                    dX
2.2                     yLen
1/30                    dY
2.0                     zLen
1/30                    dZ
0.                      xAngle
0.                      yAngle
0.                      zAngle
&#123;MHD&#125; status            NameVars
&#123;default&#125;               NamePars
box VAR idl             StringPlot
-1                      DnSavePlot
1.                      DtSavePlot
GSE                     TypeCoord
1.0                     x0
-1.8                    y0
2.0                     z0
7.0                     xLen
1/32                    dX
8.4                     yLen
1/32                    dY
0.01                    zLen
1/32                    dZ
0.                      xAngle
0.                      yAngle
0.                      zAngle
&#123;MHD&#125; status theta1 phi1 theta2 phi2 blk                NameVars
&#123;default&#125;               NamePars
cut MHD tcp		StringPlot
-100			DnSavePlot
10.			DtSavePlot
1.
5.
0.
360.
-90.
90.

#END_COMP GM --------------------------------------------------------------

#STOP
-30000			MaxIteration
1200.			tSimulationMax</code></pre>
<p><hr />grid structure––––––––- #GRIDGEOMETRY spherical_lnr           TypeGeometry</p>
<p>#GRID 10                        proc<em>dims&#40;1&#41;           nRootBlockX 8                        proc</em>dims&#40;2&#41;           nRootBlockY 8                        proc_dims&#40;3&#41;,          nRootBlockZ -100                     x1            xMin  100                     x2            xMax -100                     y1            yMin  100                     y2            yMax -100                     z1            zMin  100                     z2            zMax</p>
<p>#LIMITRADIUS 0.5			rMin 174.0                   rMax &gt; &#40;sqrt&#40;100^2&#43;100^2&#43;100^2&#41;&#41;</p>
<p>#GRIDLEVEL 2			nLevelArea initial			NameArea</p>
<p>#GRIDLEVEL 2			nLevelArea box_gen         	TypeRegion 1.1             	rmin            xMinBox 0.0            		LonMin          yMinBox -65.0           	LatMin          zMinBox 4.0 	        	rmax            xMaxBox 360.0           	LonMax          yMaxBox 65.0            	LatMax          zMaxBox</p>
<p>#GRIDLEVEL 1			nLevelArea box_gen			TypeRegion 5.0			rmin -70.0			LonMin 35.0			LatMin 15.0			rmax 70.0			LonMax 65.0			Latmax</p>
<p>#GRIDLEVEL 1			nLevelArea box_gen			TypeRegion 5.0			rmin -70.0			LonMin -35.0			LatMin 15.0			rmax 70.0			LonMax -65.0			LatMax ––––––––end grid structure–––––––</p>
<p><hr />PIC––––––––- #PICUNIT 1.0                     xUnitPicSi &#91;m&#93; 4000.0e3                uUnitPicSi &#91;m/s&#93;</p>
<p>#PICREGION 1                       nPicRegion -2.5                    xMinCut -1.125                  xMaxCut -2.                     yMinCut</p>
<ol start=2 >
<li><pre><code>                yMaxCut</code></pre>

</ol>
<p>-2.2                    zMinCut  2.2                    zMaxCut 1/32                    DxPic 1/32                    DyPic 1/32                    DzPic –––––––-end PIC–––––––</p>
<p><hr />BC––––––––- #OUTERBOUNDARY fixedb1			TypeCellBc1 none			TypeCellBc2 periodic		TypeCellBc3 periodic		TypeCellBc4 periodic		TypeCellBc5 periodic		TypeCellBc6</p>
<p>#BOXBOUNDARY fixed			TypeBcXmin fixed			TypeBcXmax float			TypeBcYmin float			TypeBcYmax float			TypeBcZmin float			TypeBcZmax</p>
<p>#BOUNDARYSTATE coord1max xminbox xmaxbox         StringBoundary 28.0                    BoundaryStateDim<em>V Rho 140.0                   BoundaryStateDim</em>V Ux 0.0                     BoundaryStateDim<em>V Uy 0.0                     BoundaryStateDim</em>V Uz -7.0                   	BoundaryStateDim<em>V Bx 78.0                    BoundaryStateDim</em>V By -76.0                   BoundaryStateDim<em>V Bz 0.0                     BoundaryStateDim</em>V Hyp 0.1                   	BoundaryStateDim<em>V Pe 1.7                   	BoundaryStateDim</em>V p</p>
<p>#BOUNDARYSTATE coord1min solid		StringBoundary 550.0	  		BoundaryStateDim<em>V Rho 0.0                     BoundaryStateDim</em>V Ux 0.0                     BoundaryStateDim<em>V Uy 0.0                     BoundaryStateDim</em>V Uz 0.0                     BoundaryStateDim<em>V Bx 0.0                     BoundaryStateDim</em>V By 0.0                     BoundaryStateDim<em>V Bz 0.0                     BoundaryStateDim</em>V Hyp 0.01			BoundaryStateDim<em>V Pe 0.115			BoundaryStateDim</em>V p</p>
<p>#SOLIDSTATE T                       UseSolidState user                    TypeBcSolid sphere                  TypeSolidGeometry 1.0                     rSolid 5e-3			SolidLimitDt ––––––-end BC–––––––</p>
<p>#RESISTIVITY T			UseResistivity user			TypeResistivity 0.0			Eta0Si</p>
<p>#USERFLAGS T                       UseUserInnerBcs F                       UseUserSource F                       UseUserPerturbation F                       UseUserOuterBcs T                       UseUserICs F                       UseUserSpecifyRefinement F                       UseUserLogFiles F                       UseUserWritePlot F                       UseUserAMR F                       UseUserEchoInput F                       UseUserB0 T                       UseUserInitSession F                       UseUserUpdateStates</p>
<p>#USERINPUTBEGIN ––––––––––</p>
<p>#INITTYPE B1U1</p>
<p>#RESISTIVEPLANET 1.0                     PlanetRadius 5                       nResistivPoints 1.05                    Radius 0.0                     Resistivity 0.95                    Radius 6e11			Resistivity 0.7                     Radius 6e11			Resistivity 0.65                    Radius 6e9			Resistivity 0.55		        Radius 0.0		        Resistivity #USERINPUTEND –––––––––––</p>
<p>#TIMESTEPPING 2			nStage 0.8			CflExlp</p>
<p>#SCHEME 2                       nOrder &#40;1 or 2&#41; Sokolov                 TypeFlux &#40;Roe, Rusanov, Linde, Sokolov mc3                     TypeLimiter 1.2                     LimiterBeta</p>
<p>#SEMIIMPLICIT T			UseSemiImplicit resistivity		TypeSemiImplicit</p>
<p>#SEMIKRYLOV GMRES			TypeKrylov &#40;GMRES, BICGSTAB, CG&#41; 0.001 			ErrorMaxKrylov 100 			MaxMatvecKrylov</p>
<p>#UPDATECHECK F                       UseUpdateCheck</p>
<p>#COARSEAXIS F			UsePoleDiffusion T			UseCoarseAxis 1			nCoarseLayer</p>
<p>#RAYTRACE T                       UseRaytrace &#40;rest is read if true&#41; T                       UseAccurateTrace 0.1                     DtExchangeRay &#91;sec&#93; 1                       DnRaytrace</p>
<p>#HALLRESISTIVITY T                       UseHallResist &#40;rest of parameters read only if true&#41; 1.0                     HallFactorMax 0.1                     HallCmaxFactor</p>
<p>#HALLREGION &#43;hallbox -hallsphere -polars 0</p>
<p>#REGION hallbox                 NameRegion box tapered             NameHallRegion -4                      xMinBox -4                      yMinBox -4                      zMinBox 4                       xMaxBox 4                       yMaxBox 4                       zMaxBox 0.5                     Taper</p>
<p>#REGION hallsphere              NameRegion sphere0 tapered         StringShape 1.05                    Radius 0.05                    Taper</p>
<p>#REGION polars                  NameRegion doubleconez0 tapered    StringShape 12                      Height 2.0                     Radius 0.2                     Taper</p>
<p>#SAVEINITIAL T</p>
<p>#SAVELOGFILE T			DoSaveLogfile RAW			StringLogfile 1			DnSaveLogfile -1.			DtSaveLogfile</p>
<p>#SAVEPLOT 7                       nPlotFiles x&#61;0 VAR idl             StringPlot -1000                   DnSavePlot</p>
<ol>
<li><pre><code>                	DtSavePlot</code></pre>

</ol>
<p>-1.                     Dx &#123;MHD&#125; status           	NameVars &#123;default&#125;               NamePars y&#61;0 VAR idl             StringPlot -1000                   DnSavePlot</p>
<ol>
<li><pre><code>                	DtSavePlot</code></pre>

</ol>
<p>-1.                     Dx &#123;MHD&#125; status pic           NameVars &#123;default&#125;               NamePars z&#61;0 VAR idl             StringPlot -1000                   DnSavePlot</p>
<ol>
<li><pre><code>                	DtSavePlot</code></pre>

</ol>
<p>-1.                     Dx &#123;MHD&#125; status pic          	NameVars &#123;default&#125;               NamePars box VAR idl             StringPlot -5000                   DnSavePlot</p>
<ol>
<li><pre><code>                	DtSavePlot</code></pre>

</ol>
<p>GSE                     TypeCoord -1.0950                 x0 -0.0330                 y0 -0.3800                 z0 1.2660                  xLen 1/32                    dX 15.3340                 yLen 1/32                    dY 0.1500                  zLen 1/32                    dZ</p>
<ol>
<li><pre><code>                 xAngle</code></pre>

<li><pre><code>                 yAngle</code></pre>

<li><pre><code>                 zAngle</code></pre>

</ol>
<p>bx by bz                NameVars &#123;default&#125;               NamePars box VAR idl             StringPlot -1                      DnSavePlot</p>
<ol>
<li><pre><code>                 DtSavePlot</code></pre>

</ol>
<p>GSE                     TypeCoord -1.1                    x0 0.0                     y0 0.0                     z0 2.2                     xLen 1/30                    dX 2.2                     yLen 1/30                    dY 2.0                     zLen 1/30                    dZ</p>
<ol>
<li><pre><code>                 xAngle</code></pre>

<li><pre><code>                 yAngle</code></pre>

<li><pre><code>                 zAngle</code></pre>

</ol>
<p>&#123;MHD&#125; status            NameVars &#123;default&#125;               NamePars box VAR idl             StringPlot -1                      DnSavePlot</p>
<ol>
<li><pre><code>                 DtSavePlot</code></pre>

</ol>
<p>GSE                     TypeCoord 1.0                     x0 -1.8                    y0 2.0                     z0 7.0                     xLen 1/32                    dX 8.4                     yLen 1/32                    dY 0.01                    zLen 1/32                    dZ</p>
<ol>
<li><pre><code>                 xAngle</code></pre>

<li><pre><code>                 yAngle</code></pre>

<li><pre><code>                 zAngle</code></pre>

</ol>
<p>&#123;MHD&#125; status theta1 phi1 theta2 phi2 blk                NameVars &#123;default&#125;               NamePars cut MHD tcp		StringPlot -100			DnSavePlot 10.			DtSavePlot</p>
<ol>
<li>
<li>
<li>
<li>
</ol>
<p>-90.</p>
<ol start=90 >
<li>
</ol>
<p>#END_COMP GM –––––––––––––––––––––––––––––––</p>
<p>#STOP -30000			MaxIteration 1200.			tSimulationMax &#96;&#96;&#96;</p>
<pre><code class=language-julia >#BEGIN_COMP PC ---------------------------------------------------------------

TEST
write_plot_init

TIMESTEPPING
F       UseSWMFDt
F       UseFixedDt
0.4     CFL

#TIMESTEPPING
F       useSWMFDt
T       useFixedDt
0.025  dt &#40;SI unit&#41;

#PROCESSORS
6       XLEN
16      YLEN
20      ZLEN

#RESTART
T                       DoRrestart

#ELECTRON
-7.1428571              Charge/mass ratio &#40;qom, 100/14&#41;

SMOOTHE
T               DoSmoothAll
4               nSmooth
0.5             InnerSmoothFactor
1.5             BCSmoothFactor
10              nBoundarySmooth

#POISSON
T
100000000
0.01		PoissonTol
20		PoissonIter

#ENERGYCONSERVING
T                       useECSIM

#DISCRETIZATION
0.51                    theta
0.0                     gradRhoRatio
0.0                     cDiff
0.1                     ratioDivC2C

#DIVE
position_light		divECleanType
1                       nPower
1e-2                    Tol
20                      nIter
3                       nIterNonLinear

PARTICLEBC
3

#PARTICLES
6                       Particles per cell in X region 1
6                       Particles per cell in Y
6                       Particles per cell in Z

SOLVER
1.0e-6                  GMREStol : GMRES solver stopping criterium tolerance
100                     nGMRESRestart
3                       NiterMover : mover predictor corrector iteration

#SAVEIDL
1                       nPlotFile
3d var real4 planet	StringPlot
-1                      DnOutput
1.0                     DtOutput
0                       DxOutput
&#123;fluid&#125; qc divEc

#END_COMP PC -----------------------------------------------------------------</code></pre>
<h2 id=caveats_potential_improvements ><a href="#caveats_potential_improvements" class=header-anchor >Caveats &amp; Potential Improvements</a></h2>
<ul>
<li><p>If a run crashes and the restart time is earlier, when you restart from the earlier time, there will be duplicate output files generated. These files typically have identical time tag &#40;<code>txxxxxx</code>&#41; but different iteration step tag &#40;<code>nxxxxxx</code>&#41;. One automated way to clean this up is to check which one comes later and delete the eariler one. However, this is not available as of 2024/06/21.</p>

</ul>
<div class=page-foot >
  <div class=copyright >
    &copy; Hongyang Zhou. Last modified: September 17, 2025. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a>.
  </div>
</div>
</div>
    </div>  
    
    
        <script src="/Ganymede/libs/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script>